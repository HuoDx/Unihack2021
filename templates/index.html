<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <title>活点地图</title>
    <link rel="shortcut icon" href="/static/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="Description" content="活点地图 - 实时显示附近的资源">
    <style type="text/css">
        html {
            height: 100%
        }

        body {
            height: 100%;
            margin: 0px;
            padding: 0px
        }

        #map-view {
            height: 100%
        }
    </style>
    <script type="text/javascript" src="https://api.map.baidu.com/api?type=webgl&v=1.0&ak={{access_key}}"></script>
</head>

<body>
    <div id="map-view"></div>
    <script>
        var geolocation = new BMapGL.Geolocation();
        async function locate() {
            return new Promise((resolve, reject) => {
                geolocation.getCurrentPosition(
                    function(r) {
                        if (this.getStatus() == BMAP_STATUS_SUCCESS) {
                            console.log('您的位置：' + r.point.lng + ',' + r.point.lat);
                            resolve(r)
                        }
                        else {
                            let errorMessage = this.getStatus()
                            console.error('failed' + errorMessage)
                            reject(errorMessage)
                        }
                    }
                )
            })
        }
        (async () => {
            var map = new BMapGL.Map('map-view');
            
            var location = await locate()
            map.enableScrollWheelZoom(true);
            map.centerAndZoom(location.point, 20);
            
            map.setDisplayOptions({
                poiText: true,  
                poiIcon: true, 
                building: true,  

            });
            var mk = new BMapGL.Marker(location.point);
            map.addOverlay(mk);
            var locationControl = new BMapGL.LocationControl()
            map.addControl(locationControl)

        })()



    </script>
</body>